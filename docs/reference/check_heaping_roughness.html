<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Evaluate roughness of data in 5-year age groups — check_heaping_roughness • DemoTools</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Evaluate roughness of data in 5-year age groups — check_heaping_roughness" />
<meta property="og:description" content="For a given age-structured vector of counts, how rough is data after grouping to 5-year age bins? Data may require smoothing even if there is no detectable sawtooth pattern. It is best to use the value in this method together with visual evidence to gauge whether use of smooth_age_5() is recommended." />
<meta property="og:image" content="https://timriffe.github.io/DemoTools/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-reverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DemoTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">01.13.76</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Short manuals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Age-heaping_quality_with_Demotools.html">Handle age heaping</a>
    </li>
    <li>
      <a href="../articles/graduation_with_demotools.html">Graduate demographic counts</a>
    </li>
    <li>
      <a href="../articles/smoothing_with_demotools.html">Smooth demographic counts</a>
    </li>
    <li>
      <a href="../articles/lifetables_with_demotools.html">Construct a lifetable</a>
    </li>
    <li>
      <a href="../articles/migration_with_demotools.html">Model migration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/case_study_1.html">Case study</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/timriffe1">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/timriffe/DemoTools/">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluate roughness of data in 5-year age groups</h1>
    <small class="dont-index">Source: <a href='https://github.com/timriffe/DemoTools/blob/master/R/check_heaping.R'><code>R/check_heaping.R</code></a></small>
    <div class="hidden name"><code>check_heaping_roughness.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For a given age-structured vector of counts, how rough is data after grouping to 5-year age bins? Data may require smoothing even if there is no detectable sawtooth pattern. It is best to use the value in this method together with visual evidence to gauge whether use of <code><a href='smooth_age_5.html'>smooth_age_5()</a></code> is recommended.</p>
    </div>

    <pre class="usage"><span class='fu'>check_heaping_roughness</span><span class='op'>(</span>
  <span class='va'>Value</span>,
  <span class='va'>Age</span>,
  ageMin <span class='op'>=</span> <span class='fl'>20</span>,
  ageMax <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span><span class='op'>(</span><span class='va'>Age</span><span class='op'>[</span><span class='va'>Age</span><span class='op'>%%</span><span class='fl'>5</span> <span class='op'>==</span> <span class='fl'>0</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Value</th>
      <td><p>numeric. A vector of demographic counts by single age.</p></td>
    </tr>
    <tr>
      <th>Age</th>
      <td><p>numeric. A vector of ages corresponding to the lower integer bound of the counts.</p></td>
    </tr>
    <tr>
      <th>ageMin</th>
      <td><p>integer evenly divisible by 5. Lower bound of evaluated age range, default 20.</p></td>
    </tr>
    <tr>
      <th>ageMax</th>
      <td><p>integer evenly divisible by 5. Upper bound of evaluated age range, defaults to highest age evenly divisible by 10.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>First we group data to 5-year age bins. Then we take first differences (d1) of these within the evaluated age range. Then we smooth first differences (d1s) using a generic smoother (<code>ogive()</code>). Roughness is defined as the mean of the absolute differences between <code><a href='https://rdrr.io/r/base/mean.html'>mean(abs(d1 - d1s) / abs(d1s))</a></code>. Higher values indicate rougher data, and may suggest more aggressive smoothing. Just eyeballing, one could consider smoothing if the returned value is greater than ca 0.2, and values greater than 0.5 already highly recommend it (pending visual verification).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>Age</span> <span class='op'>&lt;-</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>99</span>
<span class='va'>A5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>95</span>,by<span class='op'>=</span><span class='fl'>5</span><span class='op'>)</span>
<span class='va'>smoothed</span> <span class='op'>&lt;-</span> <span class='fu'><a href='graduate_sprague.html'>graduate_sprague</a></span><span class='op'>(</span>
    <span class='fu'><a href='smooth_age_5.html'>smooth_age_5</a></span><span class='op'>(</span><span class='va'>pop1m_pasex</span>,
        <span class='va'>Age</span>,
        method <span class='op'>=</span> <span class='st'>"Strong"</span>,
        OAG <span class='op'>=</span> <span class='cn'>FALSE</span>,
        young.tail <span class='op'>=</span> <span class='st'>"Arriaga"</span><span class='op'>)</span>,
    Age <span class='op'>=</span> <span class='va'>A5</span>,
    OAG <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='co'># not very rough, no need to smooth more</span>
<span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.05958194</div><div class='input'> <span class='co'># quite rough, even after grouping to 5-year ages</span>
<span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>pop1m_pasex</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.5530865</div><div class='input'><span class='co'># heaped, but no 0&gt;5 preference</span>
<span class='va'>h1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='heapify.html'>heapify</a></span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span>, p0 <span class='op'>=</span> <span class='fl'>1</span>, p5 <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='co'># heaping progressively worse</span>
<span class='va'>h2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='heapify.html'>heapify</a></span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span>, p0 <span class='op'>=</span> <span class='fl'>1.2</span>, p5 <span class='op'>=</span> <span class='fl'>1.2</span><span class='op'>)</span>
<span class='va'>h3</span> <span class='op'>&lt;-</span> <span class='fu'><a href='heapify.html'>heapify</a></span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span>, p0 <span class='op'>=</span> <span class='fl'>1.5</span>, p5 <span class='op'>=</span> <span class='fl'>1.5</span><span class='op'>)</span>
<span class='va'>h4</span> <span class='op'>&lt;-</span> <span class='fu'><a href='heapify.html'>heapify</a></span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span>, p0 <span class='op'>=</span> <span class='fl'>2</span>, p5 <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='va'>h5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='heapify.html'>heapify</a></span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span>, p0 <span class='op'>=</span> <span class='fl'>2.5</span>, p5 <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'>#cols &lt;- RColorBrewer::brewer.pal(7,"Reds")[3:7]</span>
 <span class='va'>cols</span> <span class='op'>&lt;-</span>  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"#FC9272"</span>, <span class='st'>"#FB6A4A"</span>, <span class='st'>"#EF3B2C"</span>, <span class='st'>"#CB181D"</span>, <span class='st'>"#99000D"</span><span class='op'>)</span>

  <span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>smoothed</span><span class='op'>)</span>, type<span class='op'>=</span><span class='st'>'l'</span>,xlim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>20</span>,<span class='fl'>80</span><span class='op'>)</span>,ylim<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>,<span class='fl'>3e5</span><span class='op'>)</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>h1</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>h2</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span>
  <span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>h3</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>h4</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>]</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='va'>A5</span>, <span class='fu'><a href='groupAges.html'>groupAges</a></span><span class='op'>(</span><span class='va'>h5</span><span class='op'>)</span>,col<span class='op'>=</span><span class='va'>cols</span><span class='op'>[</span><span class='fl'>5</span><span class='op'>]</span><span class='op'>)</span>
<span class='op'>}</span>
<span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>smoothed</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.05958194</div><div class='input'><span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>h1</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.07530694</div><div class='input'><span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>h2</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1036847</div><div class='input'><span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>h3</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.1737339</div><div class='input'><span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>h4</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.7451597</div><div class='input'><span class='fu'>check_heaping_roughness</span><span class='op'>(</span><span class='va'>h5</span>, <span class='va'>Age</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 1.868327</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tim Riffe, José Manuel Aburto, Ilya Kashnitsky, Monica Alexander, Marius D. Pascariu, Sara Hertog, Sean Fennell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


