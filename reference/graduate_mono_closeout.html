<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>blend the Sprague upper boundary age estimates into monotonic spline estimates — graduate_mono_closeout • DemoTools</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="blend the Sprague upper boundary age estimates into monotonic spline estimates — graduate_mono_closeout" />
<meta property="og:description" content="A simple monotonic spline on the cumulative sum of population counts may return more convincing single age count estimates than the Sprague or other splitting methods. This function blends the given single age population estimates starting at pivotAge." />
<meta property="og:image" content="https://timriffe.github.io/DemoTools/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-reverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">DemoTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">01.13.64</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Short manuals
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Age-heaping_quality_with_Demotools.html">Handle age heaping</a>
    </li>
    <li>
      <a href="../articles/graduation_with_demotools.html">Graduate demographic counts</a>
    </li>
    <li>
      <a href="../articles/smoothing_with_demotools.html">Smooth demographic counts</a>
    </li>
    <li>
      <a href="../articles/lifetables_with_demotools.html">Construct a lifetable</a>
    </li>
    <li>
      <a href="../articles/migration_with_demotools.html">Model migration</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/case_study_1.html">Case study</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/timriffe1">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/timriffe/DemoTools/">
    <span class="fa fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>blend the Sprague upper boundary age estimates into monotonic spline estimates</h1>
    <small class="dont-index">Source: <a href='https://github.com/timriffe/DemoTools/blob/master/R/graduate.R'><code>R/graduate.R</code></a></small>
    <div class="hidden name"><code>graduate_mono_closeout.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A simple monotonic spline on the cumulative sum of population counts may return more convincing single age count estimates than the Sprague or other splitting methods. This function blends the given single age population estimates starting at <code>pivotAge</code>.</p>
    </div>

    <pre class="usage"><span class='fu'>graduate_mono_closeout</span><span class='op'>(</span>
  <span class='va'>Value</span>,
  <span class='va'>Age</span>,
  <span class='va'>pops</span>,
  pivotAge <span class='op'>=</span> <span class='fl'>90</span>,
  splitfun <span class='op'>=</span> <span class='va'>graduate_sprague</span>,
  OAG <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>Value</th>
      <td><p>numeric vector, presumably counts in grouped ages</p></td>
    </tr>
    <tr>
      <th>Age</th>
      <td><p>integer vector, lower bounds of age groups</p></td>
    </tr>
    <tr>
      <th>pops</th>
      <td><p>optional numeric vector of single age population counts derived from <code>Value</code>.</p></td>
    </tr>
    <tr>
      <th>pivotAge</th>
      <td><p>integer (default 90). Age at which to switch to spline-based estimates.</p></td>
    </tr>
    <tr>
      <th>splitfun</th>
      <td><p>optional. The function used to create pops. Default <code>graduate_sprague</code>. Could also be <code>graduate_grabill</code>, or any other function that similarly transforms.</p></td>
    </tr>
    <tr>
      <th>OAG</th>
      <td><p>logical (default <code>FALSE</code>). Would we like to re-impute the last
element of <code>Value</code> as the open age group?</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments to be optionally passed to <code>splitfun()</code>.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>numeric matrix of age by year estimates of single-age counts.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The <code>pivotAge</code> must be at least 10 years below the maximum age detected from
<code><a href='https://rdrr.io/r/base/colnames.html'>rownames(popmat)</a></code>, but not lower than 75. In the exact <code>pivotAge</code>, we may either take the Sprague estimates or the spline estimates, depending on which is larger, then the single-age estimates for this 5-year age group are rescaled to sum to the original total in <code>Value</code>. Higher ages are taken from the spline-based age splits. The spline results are derive from the <code>"hyman"</code> method of <code><a href='https://rdrr.io/r/stats/splinefun.html'>splinefun()</a></code> on the cumulative sum of the original age grouped data. One could use this function to perform the same closeout to Grabill estimates, if these are given via the <code>pops</code> argument. See examples. Note that the Grabill split method mixed with this closeout will not necessarily preserve the annual totals, and this function performs to rescaling. The open age group is preserved (and must be included in <code>Value</code>).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>a5</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/integer.html'>as.integer</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/colnames.html'>rownames</a></span><span class='op'>(</span><span class='va'>pop5_mat</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>popvec</span>               <span class='op'>&lt;-</span> <span class='va'>pop5_mat</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>
<span class='va'>closed.out</span>           <span class='op'>&lt;-</span> <span class='fu'>graduate_mono_closeout</span><span class='op'>(</span>Value <span class='op'>=</span> <span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>closed.out</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>popvec</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0</div><div class='input'><span class='fu'>graduate_mono_closeout</span><span class='op'>(</span>Value <span class='op'>=</span> <span class='va'>popvec</span>, pivotAge <span class='op'>=</span> <span class='fl'>85</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
</div><div class='output co'>#&gt;            0            1            2            3            4            5 
#&gt; 12172.491200 11380.448000 10717.448000 10171.000000  9728.612800  9377.795200 
#&gt;            6            7            8            9           10           11 
#&gt;  9106.056000  8900.904000  8749.848000  8640.396800  8573.614400  8550.564800 
#&gt;           12           13           14           15           16           17 
#&gt;  8490.980800  8355.260800  8171.579200  8008.380800  7852.779200  7694.259200 
#&gt;           18           19           20           21           22           23 
#&gt;  7534.675200  7373.905600  7210.820800  7046.662400  6881.606400  6715.966400 
#&gt;           24           25           26           27           28           29 
#&gt;  6550.944000  6386.521600  6221.616000  6065.656000  5922.992000  5789.214400 
#&gt;           30           31           32           33           34           35 
#&gt;  5656.478400  5527.451200  5393.875200  5251.203200  5103.992000  4958.454400 
#&gt;           36           37           38           39           40           41 
#&gt;  4809.878400  4676.390400  4566.518400  4469.758400  4372.048000  4282.163200 
#&gt;           42           43           44           45           46           47 
#&gt;  4161.715200  3992.091200  3793.982400  3600.371200  3397.075200  3237.659200 
#&gt;           48           49           50           51           52           53 
#&gt;  3149.675200  3104.219200  3052.772800  3014.564800  2923.268800  2744.044800 
#&gt;           54           55           56           57           58           59 
#&gt;  2513.348800  2294.264000  2064.318400  1897.942400  1835.374400  1836.100800 
#&gt;           60           61           62           63           64           65 
#&gt;  1826.950400  1831.654400  1779.182400  1629.734400  1422.478400  1231.844800 
#&gt;           66           67           68           69           70           71 
#&gt;  1037.502400   891.830400   826.646400   813.176000   792.096000   776.793600 
#&gt;           72           73           74           75           76           77 
#&gt;   745.817600   683.017600   601.275200   529.699200   462.560000   401.280000 
#&gt;           78           79           80           81           82           83 
#&gt;   349.512000   304.948800   261.433600   219.961600   183.169600   151.681600 
#&gt;           84           85           86           87           88           89 
#&gt;   124.753600   101.692205    79.932348    61.686246    46.953898    35.735304 
#&gt;           90           91           92           93           94           95 
#&gt;    27.603433    20.850155    15.048439    10.198284     6.299690     3.438064 
#&gt;           96           97           98           99          100 
#&gt;     1.955032     1.936000     3.380968     6.289936     0.000000 </div><div class='input'><span class='co'># giving a different single-age split to close out this way:</span>
<span class='va'>popg</span>                 <span class='op'>&lt;-</span> <span class='fu'><a href='graduate_grabill.html'>graduate_grabill</a></span><span class='op'>(</span>Value <span class='op'>=</span> <span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>grabill.closed.out</span>   <span class='op'>&lt;-</span> <span class='fu'>graduate_mono_closeout</span><span class='op'>(</span>Value <span class='op'>=</span> <span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, pops <span class='op'>=</span> <span class='va'>popg</span><span class='op'>)</span>
<span class='co'># totals not necessarily preserved if mixed w Grabill</span>
<span class='co'># I wouldn't recommend a rescale of the total, since the</span>
<span class='co'># only part we mess with here is the old age section. Ergo,</span>
<span class='co'># one may wish to instead rescale results colSums() of</span>
<span class='co'># popg at age pivotAge and higher.</span>
<span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>grabill.closed.out</span><span class='op'>)</span> <span class='op'>-</span> <span class='fu'><a href='https://rdrr.io/r/base/sum.html'>sum</a></span><span class='op'>(</span><span class='va'>popvec</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] -22.01899</div><div class='input'><span class='co'># also works on an age-labeled vector of data</span>
<span class='va'>closed.vec</span>           <span class='op'>&lt;-</span> <span class='fu'>graduate_mono_closeout</span><span class='op'>(</span><span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># let's compare this one with sprague()</span>
<span class='va'>simple.vec</span>           <span class='op'>&lt;-</span> <span class='fu'><a href='graduate_sprague.html'>graduate_sprague</a></span><span class='op'>(</span><span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='co'># and with a simple monotonic spline</span>
<span class='va'>mono.vec</span>             <span class='op'>&lt;-</span> <span class='fu'><a href='graduate_mono.html'>graduate_mono</a></span><span class='op'>(</span><span class='va'>popvec</span>, Age <span class='op'>=</span> <span class='va'>a5</span>, OAG <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/plot.default.html'>plot</a></span><span class='op'>(</span><span class='fl'>85</span><span class='op'>:</span><span class='fl'>100</span>,<span class='va'>simple.vec</span><span class='op'>[</span><span class='fl'>86</span><span class='op'>:</span><span class='fl'>101</span><span class='op'>]</span>, type <span class='op'>=</span> <span class='st'>'l'</span>,
 main <span class='op'>=</span> <span class='st'>"In this case graduate_sprague() is the smoothest"</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='fl'>85</span><span class='op'>:</span><span class='fl'>100</span>,<span class='va'>closed.vec</span><span class='op'>[</span><span class='fl'>86</span><span class='op'>:</span><span class='fl'>101</span><span class='op'>]</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, lwd <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/lines.html'>lines</a></span><span class='op'>(</span><span class='fl'>85</span><span class='op'>:</span><span class='fl'>100</span>,<span class='va'>mono.vec</span><span class='op'>[</span><span class='fl'>86</span><span class='op'>:</span><span class='fl'>101</span><span class='op'>]</span>, col <span class='op'>=</span> <span class='st'>"blue"</span>, lty <span class='op'>=</span> <span class='fl'>2</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/graphics/legend.html'>legend</a></span><span class='op'>(</span><span class='st'>"topright"</span>,lty<span class='op'>=</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>2</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"black"</span>,<span class='st'>"red"</span>,<span class='st'>"blue"</span><span class='op'>)</span>,lwd <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>1</span><span class='op'>)</span>,
    legend <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"graduate_sprague()"</span>,<span class='st'>"monoCloseout()"</span>, <span class='st'>"graduate_mono()"</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tim Riffe, José Manuel Aburto, Ilya Kashnitsky, Monica Alexander, Marius D. Pascariu, Sara Hertog, Sean Fennell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


